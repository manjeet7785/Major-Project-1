<% layout("/layouts/boilerplate") %>

  <div class="container mt-4 mb-4">
    <div class="row mb-4">
      <div class="col-12">
        <h2 class="mb-3"><strong>
            <%= show.title %>
          </strong></h2>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6">
        <div class="card shadow-sm mb-4">
          <div id="propertyCarousel" class="carousel slide position-relative" data-bs-ride="carousel">
            <div class="carousel-inner">
              <% if (show.images && show.images.length> 0) { %>
                <% show.images.forEach((img, index)=> { %>
                  <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                    <img src="<%= img.url %>" class="d-block w-100" alt="Property Image <%= index + 1 %>"
                      style="height: 400px; object-fit: cover;">
                  </div>
                  <% }) %>
                    <% } else if (show.image && show.image.url) { %>
                      <div class="carousel-item active">
                        <img src="<%= show.image.url %>" class="d-block w-100" alt="Property Image"
                          style="height: 400px; object-fit: cover;">
                      </div>
                      <% } else { %>
                        <div class="carousel-item active">
                          <img src="https://via.placeholder.com/800x400?text=No+Image" class="d-block w-100"
                            alt="No Image" style="height: 400px; object-fit: cover;">
                        </div>
                        <% } %>
            </div>
            <% if ((show.images && show.images.length> 1) || (!show.images && show.image)) { %>
              <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
              <% } %>
                <div class="position-absolute bottom-0 end-0 m-3">
                  <span class="badge bg-dark">
                    <% if (show.images && show.images.length> 0) { %>
                      <%= show.images.length %> Photos
                        <% } else { %>
                          1 Photo
                          <% } %>
                  </span>
                </div>
          </div>
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <i class="bi bi-heart" style="font-size: 1.5rem; color: #e91e63; margin-right: 10px;"></i>
              <span><strong>First Come First Serve</strong></span>
            </div>
            <div class="d-flex justify-content-between">
              <div>
                <strong>Contact Owner</strong><br>
                <small class="text-muted">Get response within 12 hours</small>
              </div>
              <a href="#FormDetails" class="btn btn-primary btn-sm">Contact</a>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="row g-2 p-2">
            <% if (show.images && show.images.length> 0) { %>
              <% show.images.forEach((img, index)=> { %>
                <div class="col-3">
                  <img src="<%= img.url %>" class="img-thumbnail" alt="Thumbnail <%= index + 1 %>"
                    style="height: 80px; width: 100%; object-fit: cover; cursor: pointer;"
                    data-bs-target="#propertyCarousel" data-bs-slide-to="<%= index %>">
                </div>
                <% }) %>
                  <% } else if (show.image && show.image.url) { %>
                    <div class="col-12">
                      <img src="<%= show.image.url %>" class="img-thumbnail" alt="Property"
                        style="height: 150px; width: 100%; object-fit: cover;">
                    </div>
                    <% } %>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="row mb-3">
          <div class="col-6">
            <h6 class="text-muted">Area</h6>
            <p class="fs-5"><strong>
                <%= show.sqFeet || 'N/A' %> sq.ft.
              </strong></p>
          </div>
          <div class="col-6">
            <h6 class="text-muted">Configuration</h6>
            <p class="fs-5"><strong>
                <%= show.propertyType || 'N/A' %>
              </strong></p>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-6">
            <h6 class="text-muted">Price</h6>
            <p class="fs-5"><strong>₹<%= show.price.toLocaleString("en-IN") %></strong></p>
            <small class="text-muted">@ ₹<%= Math.round(show.price / show.sqFeet) %> per sq.ft.</small>
          </div>
          <div class="col-6">
            <h6 class="text-muted">Address</h6>
            <p class="fs-5"><strong>
                <%= show.location %>
              </strong></p>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-6">
            <h6 class="text-muted">Total Floors</h6>
            <p class="fs-5"><strong>1 Floor</strong></p>
          </div>
          <div class="col-6">
            <h6 class="text-muted">Facing</h6>
            <p class="fs-5"><strong>East</strong></p>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-6">
            <h6 class="text-muted">Overlooking</h6>
            <p class="fs-5"><strong>Main Road</strong></p>
          </div>
          <div class="col-6">
            <h6 class="text-muted">Possession in</h6>
            <p class="fs-5"><strong>Immediate</strong></p>
          </div>
        </div>
        <div class="card p-4 mb-4">
          <h6><strong>Key Highlights</strong></h6>
          <div class="row">
            <div class="col-6">
              <div class="mb-2">
                <i class="bi bi-check-circle-fill text-success" style="margin-right: 8px;"></i>
                <small>East Facing</small>
              </div>
              <div class="mb-2">
                <i class="bi bi-check-circle-fill text-success" style="margin-right: 8px;"></i>
                <small>Nearby Market</small>
              </div>
            </div>
            <div class="col-6">
              <div class="mb-2">
                <i class="bi bi-check-circle-fill text-success" style="margin-right: 8px;"></i>
                <small>Private Area</small>
              </div>
              <div class="mb-2">
                <i class="bi bi-check-circle-fill text-success" style="margin-right: 8px;"></i>
                <small>Friendly</small>
              </div>
            </div>
          </div>
          <a href="#" class="text-primary mt-2" style="text-decoration: none;"><small>View More →</small></a>
        </div>
      </div>
    </div>
    <div class="row mb-4">
      <div class="col-12">
        <div class="card p-4">
          <h6 class="mb-3"><strong>Property Details</strong></h6>
          <div class="row">
            <div class="col-md-3 mb-3">
              <small class="text-muted">Transaction Type</small>
              <p><strong>Resale</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Property Ownership</small>
              <p><strong>Freehold</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Flooring</small>
              <p><strong>Vitrified</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Furnishing</small>
              <p><strong>Semifurnished</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Width of Facing Road</small>
              <p><strong>25.0 Feet</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Gated Community</small>
              <p><strong>Yes</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Corner Property</small>
              <p><strong>Yes</strong></p>
            </div>
            <div class="col-md-3 mb-3">
              <small class="text-muted">Parking</small>
              <p><strong>1 Covered</strong></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mb-4">
      <div class="col-12">
        <div class="card p-4">
          <h6 class="mb-3"><strong>About Property</strong></h6>
          <p class="mb-2"><strong>Address:</strong>
            <%= show.location %>, <%= show.country %>
          </p>
          <p>
            <%= show.description %>
          </p>
          <a href="#" class="text-primary" style="text-decoration: none;">More >></a>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-6">
        <div class="card p-4 mb-4">
          <h6 class="mb-3"><strong>Dealer Details</strong></h6>
          <div class="d-flex align-items-center mb-3">
            <div style="width: 60px; height: 60px; background: #e0e0e0; border-radius: 50%; margin-right: 15px;"></div>
            <div>
              <% if (show.owner) { %>
                <h6 class="mb-0"><strong>
                    <%= show.owner.username %>
                  </strong></h6>
                <small class="text-muted">RERA REGISTERED</small>
                <% } %>
            </div>
          </div>
          <button class="btn btn-success w-100 mb-3"
            onclick="document.getElementById('ownerEmail').style.display='block'; this.style.display='none';">Contact by
            Email</button>
          <p id="ownerEmail" style="display: none;"><strong>Email:</strong> manjeetproperty@gmail.com</p>
          <p><strong>Properties Listed:</strong> 4</p>
          <p><strong>Localities:</strong>
            <%= show.location %>
          </p>
          <p><small>Professional real estate dealer specializing in property sales</small></p>
        </div>
      </div>
      <div id="FormDetails" class="col-lg-6">
        <div class="card p-4 mb-4">
          <h6 class="mb-3"><strong>Send Enquiry to Owner</strong></h6>
          <form action="/listings/<%= show._id %>/reviews" method="POST">
            <div class="mb-3">
              <label class="form-label"><small>You are</small></label>
              <div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="userType" id="individual" value="individual">
                  <label class="form-check-label" for="individual"><small>Individual</small></label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="userType" id="dealer" value="dealer">
                  <label class="form-check-label" for="dealer"><small>Dealer</small></label>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label"><small>Your Reason to Buy</small></label>
              <div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="reason" id="investment" value="investment">
                  <label class="form-check-label" for="investment"><small>Investment</small></label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="reason" id="selfuse" value="selfuse">
                  <label class="form-check-label" for="selfuse"><small>Self Use</small></label>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="name" class="form-label"><small>Name</small></label>
              <input type="text" class="form-control" id="name" name="name" placeholder="Your Name" required>
            </div>

            <div class="mb-3">
              <label for="phone" class="form-label"><small>Phone Number</small></label>
              <div class="input-group">
                <select class="form-select" style="max-width: 80px;">
                  <option>IND (+91)</option>
                </select>
                <input type="tel" class="form-control" id="phone" name="phone" placeholder="Phone Number" required>
              </div>
            </div>

            <div class="mb-3">
              <label for="message" class="form-label"><small>Message</small></label>
              <textarea class="form-control" id="message" name="message" rows="4"
                placeholder="I am interested in this Property."></textarea>
            </div>

            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="terms" required>
              <label class="form-check-label" for="terms">
                <small>I agree to the Terms & Conditions and Privacy Policy</small>
              </label>
            </div>

            <button type="submit" class="btn btn-primary w-100">Send Email & SMS</button>
          </form>
        </div>
      </div>
    </div>
    <% if(currUser && show.owner && currUser._id.equals(show.owner._id)) { %>
      <div class="row mb-4 mt-3">
        <div class="col-12">
          <a href="/listings/<%= show._id %>/edit" class="btn btn-dark me-2">Edit Listing</a>
          <form method="POST" action="/listings/<%=show._id%>?_method=DELETE" style="display: inline;">
            <button class="btn btn-danger">Delete Listing</button>
          </form>
        </div>
      </div>
      <% } %>

        <div class="row mt-4">
          <div class="col-12">
            <h4 class="mb-4"><strong>Reviews & Ratings</strong></h4>
          </div>
        </div>
        <% if(currUser) { %>
          <div class="row mb-4">
            <div class="col-12">
              <div class="card p-4">
                <h6 class="mb-3"><strong>Share Your Experience</strong></h6>
                <form action="/listings/<%= show._id%>/reviews" method="post" novalidate class="needs-validation">
                  <div class="mb-3">
                    <label class="form-label"><strong>Rating</strong></label>
                    <fieldset class="starability-slot">
                      <legend>Rate this property:</legend>
                      <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="0" checked
                        aria-label="No rating." />
                      <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                      <label for="first-rate1" title="Poor">1 star</label>
                      <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                      <label for="first-rate2" title="Fair">2 stars</label>
                      <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                      <label for="first-rate3" title="Good">3 stars</label>
                      <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                      <label for="first-rate4" title="Very Good">4 stars</label>
                      <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                      <label for="first-rate5" title="Excellent">5 stars</label>
                    </fieldset>
                  </div>

                  <div class="mb-3">
                    <label for="comment" class="form-label"><strong>Comments</strong></label>
                    <textarea name="review[comment]" id="comment" rows="5" class="form-control"
                      placeholder="Share your experience about this property..." required></textarea>
                    <div class="invalid-feedback">Please add a comment for your review</div>
                  </div>

                  <button type="submit" class="btn btn-primary">Submit Review</button>
                </form>
              </div>
            </div>
          </div>
          <% } %>
            <div class="row">
              <div class="col-12">
                <h5 class="mb-3"><strong>All Reviews (<%= show.reviews.length %>)</strong></h5>

                <% if(show.reviews.length> 0) { %>
                  <div class="row">
                    <% for(let review of show.reviews) { %>
                      <div class="col-md-6 mb-3">
                        <div class="card h-100 shadow-sm">
                          <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                              <div>
                                <h6 class="card-title mb-1">
                                  <% if (review.author) { %>
                                    <strong>
                                      <%= review.author.username %>
                                    </strong>
                                    <% } else { %>
                                      <strong>Anonymous User</strong>
                                      <% } %>
                                </h6>
                                <p class="starability-result text-warning" data-rating="<%= review.rating %>"
                                  style="font-size: 0.9rem;">
                                  <%= '★' .repeat(review.rating) %>
                                    <%= '☆' .repeat(5-review.rating) %>
                                </p>
                              </div>
                            </div>

                            <p class="card-text mb-3">
                              <%= review.comment %>
                            </p>

                            <% if(currUser && currUser._id.equals(review.author._id)) { %>
                              <form method="POST"
                                action="/listings/<%=show._id %>/reviews/<%= review._id %>?_method=DELETE">
                                <button type="submit" class="btn btn-sm btn-outline-danger">Delete Review</button>
                              </form>
                              <% } %>
                          </div>
                        </div>
                      </div>
                      <% } %>
                  </div>
                  <% } else { %>
                    <div class="alert alert-info" role="alert">
                      No reviews yet. Be the first to share your experience!
                    </div>
                    <% } %>
              </div>
            </div>
  </div>
  <% if(currUser && show.owner && currUser._id.equals(show.owner._id)) { %>
    <div class="showbtn">
      <a href="/listings/<%= show._id %>/edit" class="btn btn-dark">Edit</a>
      <form method="POST" action="/listings/<%=show._id%>?_method=DELETE">
        <button>Delete</button>
      </form>
    </div>
    <% } %>
      </div>
      </div>
      </div>